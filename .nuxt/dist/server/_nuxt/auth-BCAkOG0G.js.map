{"version":3,"file":"auth-BCAkOG0G.js","sources":["../../../../stores/auth.js"],"sourcesContent":["// stores/auth.js\r\nimport { defineStore } from 'pinia'\r\nimport { useRuntimeConfig, useNuxtApp } from '#app'\r\n\r\nexport const useAuthStore = defineStore('auth', {\r\n  state: () => ({\r\n    user: null,\r\n\ttoken: null,\r\n\tloginError: null,\r\n\tregError: null,\r\n\tregSuccess: null,\r\n  }),\r\n  \r\n  \r\n getters: {\r\n    isAuthenticated: (state) => !!state.user && !!state.token,\r\n  },\r\n  \r\n  actions: {\r\n\r\n\r\n\tasync login(credentials) {\r\n\t\t\r\n\t  try {\r\n\t\tconst { $api } = useNuxtApp();\r\n\t\tconst apiUrl = useRuntimeConfig().public.apiBaseUrl;\r\n\t\tconst { data } = await $api.post(`${apiUrl}/login`, credentials);\r\n\t\tif(data.user != \"\")\r\n\t\t{\r\n\t\t\tthis.user = data.user;\r\n\t\t\tthis.token = data.access_token; // Ensure this matches the token key in the response\r\n\t\t\t//localStorage.setItem('token', data.access_token); // Store the token in localStorage\r\n\t\t\t\r\n\t\t\tif (process.client) {\r\n            localStorage.setItem('token', data.access_token);\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t\r\n\t\t\tconsole.log('token in :', this.token);\r\n\t\t\tconst router = useRouter();\r\n\t\t\tawait router.push('/admin');\r\n\t\t\tthis.loginError = '';\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tthis.loginError = 'Login failed. Please check your credentials and try again.';\r\n\t\t}\r\n\t  } catch (error) {\r\n\t\t\r\n\t\t if (error.response && error.response.status === 401) {\r\n          this.loginError = 'Login failed. Please check your credentials and try again.';\r\n        } else {\r\n          this.loginError = 'An error occurred. Please try again later.';\r\n        }\r\n\t\tconsole.error('Error logging in:', error);\r\n\t  }\r\n\t},\r\n\r\n\t\r\n\t\r\n\t\r\n    async register(formData) {\r\n      try {\r\n        const { $api } = useNuxtApp()\r\n        const apiUrl = useRuntimeConfig().public.apiBaseUrl\r\n\t\tconst { data } = await $api.post(`${apiUrl}/register`, formData, {\r\n\t\t\theaders: {\r\n\t\t\t  'Content-Type': 'multipart/form-data'\r\n\t\t\t}\r\n\t\t})\r\n\t\tthis.regSuccess = 'user Added';\r\n\t\tthis.regError = '';\r\n        //this.user = data.user\r\n        //this.token = data.token\r\n        //localStorage.setItem('token', data.access_token)\r\n\t\tconsole.log('token in :', this.token);\r\n\t\t//this.resetRegistrationState();\r\n      } \r\n\t  \r\n\t  catch (error) {\r\n        if (error.response && error.response.status === 422) {\r\n\t\t\t\r\n          this.regError = 'Error ' + error.response.data.message;\r\n        } else {\r\n          this.regError = 'An unexpected error occurred.';\r\n        }\r\n\t\tthis.regSuccess = '';\r\n        console.error('Error registering:', error);\r\n      }\r\n\t  \r\n\t  \r\n    },\r\n    async logout() {\r\n      try {\r\n        const { $api } = useNuxtApp()\r\n        const apiUrl = useRuntimeConfig().public.apiBaseUrl\r\n        await $api.post(`${apiUrl}/logout`)\r\n        this.user = null\r\n        this.token = null\r\n        //localStorage.removeItem('token')\r\n\t\t\r\n\t\tif (process.client) {\r\n          localStorage.removeItem('token');\r\n        }\r\n\t\t\r\n\t\tconst router = useRouter()\r\n        await router.push('/login')\r\n      } catch (error) {\r\n        console.error('Error logging out:', error)\r\n      }\r\n    },\r\n    async fetchUser() {\r\n      try {\r\n        const { $api } = useNuxtApp()\r\n        const apiUrl = useRuntimeConfig().public.apiBaseUrl\r\n        const { data } = await $api.get(`${apiUrl}/user`)\r\n        this.user = data\r\n\t\tif(data)\r\n\t\t{\r\n\t\t\tconsole.log('Fetched user:', data)\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tconst router = useRouter()\r\n\t\t\tawait router.push('/login')\r\n\t\t}\r\n\t\t\r\n      } catch (error) {\r\n        console.error('Error fetching user:', error)\r\n      }\r\n    },\r\n\t\r\n\t\r\n\tresetRegistrationState() {\r\n      setTimeout(() => {\r\n        this.regError = '';\r\n        this.regSuccess = '';\r\n        console.log('State reset');\r\n      }, 3000); // Adjust delay as necessary\r\n    },\r\n\t\r\n\tinitialize() {\r\n\t\t\r\n      if (process.client) {\r\n        this.token = localStorage.getItem('token') || null;\r\n\t\t\r\n      }\r\n    },\r\n\t\r\n\t\r\n\t\r\n\t\r\n  },\r\n  \r\n\r\n  // Initialize token on store setup\r\n\r\n\r\n  \r\n  \r\n  \r\n  \r\n})\r\n\r\n\r\n"],"names":[],"mappings":";;;;;;;AAIa,MAAA,eAAe,YAAY,QAAQ;AAAA,EAC9C,OAAO,OAAO;AAAA,IACZ,MAAM;AAAA,IACT,OAAO;AAAA,IACP,YAAY;AAAA,IACZ,UAAU;AAAA,IACV,YAAY;AAAA,EAAA;AAAA,EAIZ,SAAS;AAAA,IACN,iBAAiB,CAAC,UAAU,CAAC,CAAC,MAAM,QAAQ,CAAC,CAAC,MAAM;AAAA,EACtD;AAAA,EAEA,SAAS;AAAA,IAGV,MAAM,MAAM,aAAa;AAEnB,UAAA;AACC,cAAA,EAAE,SAAS;AACX,cAAA,SAAS,mBAAmB,OAAO;AACnC,cAAA,EAAE,SAAS,MAAM,KAAK,KAAK,GAAG,MAAM,UAAU,WAAW;AAC5D,YAAA,KAAK,QAAQ,IAChB;AACC,eAAK,OAAO,KAAK;AACjB,eAAK,QAAQ,KAAK;AAGlB,cAAI,MAAgB;AAKZ,kBAAA,IAAI,cAAc,KAAK,KAAK;AACpC,gBAAM,SAAS;AACT,gBAAA,OAAO,KAAK,QAAQ;AAC1B,eAAK,aAAa;AAAA,QAAA,OAGnB;AACC,eAAK,aAAa;AAAA,QACnB;AAAA,eACU,OAAO;AAEhB,YAAI,MAAM,YAAY,MAAM,SAAS,WAAW,KAAK;AAC9C,eAAK,aAAa;AAAA,QAAA,OACb;AACL,eAAK,aAAa;AAAA,QACpB;AACE,gBAAA,MAAM,qBAAqB,KAAK;AAAA,MACvC;AAAA,IACF;AAAA,IAKG,MAAM,SAAS,UAAU;AACnB,UAAA;AACI,cAAA,EAAE,SAAS;AACX,cAAA,SAAS,mBAAmB,OAAO;AACzC,cAAA,EAAE,SAAS,MAAM,KAAK,KAAK,GAAG,MAAM,aAAa,UAAU;AAAA,UAChE,SAAS;AAAA,YACP,gBAAgB;AAAA,UAClB;AAAA,QAAA,CACA;AACD,aAAK,aAAa;AAClB,aAAK,WAAW;AAIR,gBAAA,IAAI,cAAc,KAAK,KAAK;AAAA,eAI5B,OAAO;AACT,YAAI,MAAM,YAAY,MAAM,SAAS,WAAW,KAAK;AAEnD,eAAK,WAAW,WAAW,MAAM,SAAS,KAAK;AAAA,QAAA,OAC1C;AACL,eAAK,WAAW;AAAA,QAClB;AACN,aAAK,aAAa;AACJ,gBAAA,MAAM,sBAAsB,KAAK;AAAA,MAC3C;AAAA,IAGF;AAAA,IACA,MAAM,SAAS;AACT,UAAA;AACI,cAAA,EAAE,SAAS;AACX,cAAA,SAAS,mBAAmB,OAAO;AACzC,cAAM,KAAK,KAAK,GAAG,MAAM,SAAS;AAClC,aAAK,OAAO;AACZ,aAAK,QAAQ;AAGnB,YAAI,MAAgB;AAIpB,cAAM,SAAS;AACH,cAAA,OAAO,KAAK,QAAQ;AAAA,eACnB,OAAO;AACN,gBAAA,MAAM,sBAAsB,KAAK;AAAA,MAC3C;AAAA,IACF;AAAA,IACA,MAAM,YAAY;AACZ,UAAA;AACI,cAAA,EAAE,SAAS;AACX,cAAA,SAAS,mBAAmB,OAAO;AACnC,cAAA,EAAE,KAAS,IAAA,MAAM,KAAK,IAAI,GAAG,MAAM,OAAO;AAChD,aAAK,OAAO;AAClB,YAAG,MACH;AACS,kBAAA,IAAI,iBAAiB,IAAI;AAAA,QAAA,OAGlC;AACC,gBAAM,SAAS;AACT,gBAAA,OAAO,KAAK,QAAQ;AAAA,QAC3B;AAAA,eAEa,OAAO;AACN,gBAAA,MAAM,wBAAwB,KAAK;AAAA,MAC7C;AAAA,IACF;AAAA,IAGH,yBAAyB;AACpB,iBAAW,MAAM;AACf,aAAK,WAAW;AAChB,aAAK,aAAa;AAClB,gBAAQ,IAAI,aAAa;AAAA,SACxB,GAAI;AAAA,IACT;AAAA,IAEH,aAAa;AAAA,IAMV;AAAA,EAKF;AAAA;AAUF,CAAC;"}