{"version":3,"file":"viewcat-8VPtprrF.js","sources":["../../../../components/CatSingleAdmin.vue","../../../../components/CatsAdmin.vue","../../../../composables/useCatpagination.js","../../../../pages/admin/cat/viewcat.vue"],"sourcesContent":["<!-- CatSingleAdmin.vue -->\r\n<template>\r\n<div class=\"p-2 border rounded\">\r\n\t<NuxtLink :to=\"`/admin/cat/detail/${cat.id}`\" > &rsaquo; {{ cat.name }} {{ cat.id }}</NuxtLink> \r\n\t<p v-if=\"cat.img\">\r\n\t  <NuxtLink :to=\"`/admin/cat/detail/${cat.id}`\" >\r\n\t  <img :src=\"`${config.public.BaseUrl}/images/cat/thumb/${cat.img}`\"\r\n\t  :alt=\"cat.name\" class=\"mt-2 mb-2 w-32 h-32\"/>\r\n\t  </NuxtLink>  \r\n\r\n\t</p>\r\n\r\n\t<p v-else>\r\n\t<NuxtLink :to=\"`/admin/cat/detail/${cat.id}`\" >\r\n\t\t<img src=\"~/assets/default/1.jpg\" alt=\"Default Picture\" class=\"mt-2 mb-2 w-32 h-32\"/>\r\n\t</NuxtLink> \r\n\t</p> \r\n\t<p> <NuxtLink :to=\"`/admin/cat/edit/${cat.id}`\" > &rsaquo; Edit </NuxtLink> </p>\r\n\t<p>\r\n\t<NuxtLink :to=\"`/admin/subcat/viewsubcatbycatid/${cat.id}`\" > &rsaquo; View Subcategories \r\n\t ( {{ cat.subcats_count }} )\r\n\t</NuxtLink>\r\n\t</p>\r\n\t<p>\r\n\t<NuxtLink :to=\"`/admin/subcat/addsubcat/${cat.id}`\" > &rsaquo; Add Subcategories </NuxtLink>\r\n\t</p>\r\n\r\n\t<p>\r\n\t<NuxtLink :to=\"`/admin/prod/viewprodbycatid/${cat.id}`\" > &rsaquo; View Products \r\n\t( {{ cat.prods_count }} )\r\n\t</NuxtLink>\r\n\t</p>\r\n\t<p>\r\n\t<NuxtLink :to=\"`/admin/prod/addprodbycatid/${cat.id}`\" > &rsaquo; Add Products </NuxtLink>\r\n\t</p>\r\n\t<p v-if=\"isAdmin\">\r\n\t<button  @click=\"confirmDelete(cat.id)\" class ='buttonwhite margintop5'>\r\n      &rsaquo; Delete Category\r\n    </button>\r\n\t</p>\r\n\t\r\n</div>  \r\n</template>\r\n\r\n<script setup>\r\nimport { useAuthStore } from '~/stores/auth'\r\nimport { ref, onMounted, watch, computed } from 'vue'\r\nimport { useRouter, useRoute } from 'vue-router'\r\nimport { useRuntimeConfig } from '#imports'\r\n\r\nconst router = useRouter()\r\nconst route = useRoute()\r\n\r\nconst authStore = useAuthStore()\r\nonMounted(async () => {\r\n  await authStore.fetchUser()\r\n})\r\nimport { defineProps } from 'vue'\r\n\r\n//const config = useRuntimeConfig()\r\nconst { $api } = useNuxtApp()\r\nconst apiUrl = useRuntimeConfig().public.apiBaseUrl\r\n\r\nconst isAdmin = computed(() => authStore.user && authStore.user.levell === 1)\r\n\r\nconst props = defineProps({\r\n  cat: {\r\n    type: Object,\r\n    required: true\r\n  },\r\n  config: {\r\n    type: Object,\r\n    required: true\r\n  }\r\n})\r\n\r\nconst confirmDelete = async (catId) => {\r\n  const confirmed = confirm('Are you sure you want to delete this category?')\r\n  \r\n  if (confirmed) \r\n  {\r\n    try {\r\n\r\n      await $api.delete(`/admin/deletecat/${catId}`)\r\n      \r\n   \r\n      router.push('/admin/cat/viewcat?message=deleted')\r\n    } catch (error) \r\n\t{\r\n      console.error('Error deleting category:', error.response ? error.response.data : error.message)\r\n      alert('Failed to delete the category.')\r\n    }\r\n  }\r\n}\r\n\r\n\r\n</script>\r\n","<!-- components/CatsAdmin.vue -->\r\n\r\n<script setup>\r\n\r\nimport { ref, onMounted, watch, computed } from 'vue'\r\nimport { useRouter, useRoute } from 'vue-router'\r\nimport { useRuntimeConfig } from '#imports'\r\n\r\nconst config = useRuntimeConfig()\r\n\r\nimport { defineProps } from 'vue';\r\n\r\nconst props = defineProps({\r\n  cats: {\r\n    type: Array,\r\n    required: true\r\n  },\r\n  currentPage: {\r\n    type: Number,\r\n    required: true\r\n  },\r\n  pageNumbers: {\r\n    type: Number,\r\n    required: true\r\n  },\r\n  lastPage: {\r\n    type: Number,\r\n    required: true\r\n  },\r\n  changePage: {\r\n    type: Function,\r\n    required: true\r\n  }\r\n})\r\n\r\n\r\n\r\nwatch(() => props.cats, (newCats) => {\r\n  console.log('Items updated now:', newCats);\r\n})\r\n\r\n</script>\r\n<template>\r\n\r\n\t<div class=\"w-full mt-8 mb-8\"> \r\n\t    <div class=\"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-2\">\r\n\t\t\t<CatSingleAdmin\r\n\t\t\t  v-for=\"cat in cats\"\r\n\t\t\t  :key=\"cat.id\"\r\n\t\t\t  :cat=\"cat\"\r\n\t\t\t  :config=\"config\"\r\n\t\t\t/>\r\n\t    </div>\r\n\t</div>\r\n\r\n\t\r\n\t<div class=\" bg-gray-100 fullwidth margintopbottom8 pagination \">\r\n\t\t<button @click=\"changePage(currentPage - 1)\" :disabled=\"currentPage === 1\" \r\n\t\t:class=\"['marginleft5 pager pagerwide', { red: currentPage === 1 , active: currentPage === 1 }]\"> << Previous</button>\r\n\t\t<span v-for=\"page in pageNumbers\" :key=\"page\"  class='marginleft5'>\r\n\t\t<button @click=\"changePage(page)\" :class=\"['marginleft5 pager', { red: page === currentPage, active: page === currentPage }]\" \r\n\t\t:disabled=\"page === currentPage\">{{ page }}</button>\r\n\t\t</span>\r\n\t\t<button @click=\"changePage(currentPage + 1)\" :disabled=\"currentPage === lastPage\" \r\n\t\t:class=\"['marginleft5 pager pagerwide', { red: currentPage === lastPage , active: currentPage === lastPage }]\"> >> Next</button>\r\n\t\t<span class='marginleft5'>Page {{ currentPage }} of {{ lastPage }}</span>\r\n\t</div>\r\n\t\t\t\t\r\n\t\t\t\r\n\t\t\t\r\n\t\t\t\r\n</template>\r\n\r\n\r\n","import { ref, computed } from 'vue'\r\nimport { useRuntimeConfig, useNuxtApp } from '#imports'\r\n\r\nexport function useCatPagination() {\r\n  const { $api } = useNuxtApp()\r\n  const apiUrl = useRuntimeConfig().public.apiBaseUrl\r\n\r\n  const cats = ref([])\r\n  const currentPage = ref(1)\r\n  const lastPage = ref(1)\r\n  const perPage = ref(12)\r\n  const totalCats = ref(0)\r\n\r\n  const fetchCats = async (page = 1) => {\r\n    try {\r\n      const response = await $api.get(`${apiUrl}/admin/cat/view?page=${page}&per_page=${perPage.value}`)\r\n      cats.value = response.data.data\r\n\t  \r\n      currentPage.value = response.data.current_page\r\n      lastPage.value = response.data.last_page\r\n      totalCats.value = response.data.total\r\n    } catch (error) {\r\n      console.error('Error fetching items:', error.response ? error.response.data : error.message)\r\n    }\r\n  }\r\n\r\n  const changePage = (page) => {\r\n    if (page > 0 && page <= lastPage.value) {\r\n      currentPage.value = page\r\n      fetchCats(page)\r\n    }\r\n  }\r\n\r\n  // Computed property for page numbers\r\n  const pageNumbers = computed(() => {\r\n    let pages = []\r\n    for (let i = 1; i <= lastPage.value; i++) {\r\n      pages.push(i)\r\n    }\r\n    return pages\r\n  })\r\n\r\n  return {\r\n    cats,\r\n    currentPage,\r\n    lastPage,\r\n    perPage,\r\n    totalCats,\r\n    fetchCats,\r\n    changePage,\r\n    pageNumbers,  // Return page numbers\r\n  }\r\n}\r\n\r\n","<!-- pages/admin/cat/viewcat.vue -->\r\n<script setup>\r\nimport { useAuthStore } from '~/stores/auth'\r\nimport { ref, onMounted, watch, computed } from 'vue'\r\nimport { useRouter, useRoute } from 'vue-router'\r\nimport Sidebar from '~/components/Sidebar.vue'\r\nimport MobileHeader from '~/components/MobileHeader.vue'\r\nimport { useCatPagination } from '~/composables/useCatpagination'\r\n\r\nconst { cats, currentPage, lastPage, changePage, pageNumbers, fetchCats } = useCatPagination()\r\n\r\n\r\n\r\n\r\ndefinePageMeta({\r\n  middleware: 'auth',\r\n  layout: 'admin'\r\n});\r\n\r\n\r\nconst key = ref(0)\r\n\r\nconst router = useRouter()\r\nconst route = useRoute()\r\n\r\nconst message = ref(route.query.message || '')\r\n\r\nimport { useRuntimeConfig } from '#imports'\r\nconst authStore = useAuthStore()\r\n\r\nonMounted(async () => {\r\n  await authStore.fetchUser()\r\n  fetchCats()\r\n  \r\n  if (message.value) {\r\n    const element = document.getElementById('scrollhere')\r\n    if (element) {\r\n      element.scrollIntoView({ behavior: 'smooth' })\r\n    }\r\n  }\r\n  \r\n  \r\n  \r\n\r\n})\r\n\r\n\r\nconst refreshRoute = () => {\r\n\r\nconsole.log('Route refresh attempt')\r\n  key.value += 1;\r\nconsole.log('key value' + key.value)\r\n\r\nconsole.log(route.path)\r\n\r\nrouter.replace({ path: route.path })\r\n    .then(() => {\r\n      console.log('Navigation ok, route replaced to ' + route.path);\r\n    })\r\n    .catch(err => {\r\n      console.error('Navigation error:', err);\r\n    });\r\n  console.log('end')\r\n  fetchCats()\r\n \r\n}\r\n\r\n\r\nwatch(route, async (newRoute, oldRoute) => {\r\n  console.log('Route changed from', oldRoute.path, 'to', newRoute.path);\r\n  await fetchCats();\r\n});\r\n\r\nwatch(() => route.query.message, (newMessage) => {\r\n  message.value = newMessage\r\n  \r\n  \r\n    \r\n  if (message.value) {\r\n    const element = document.getElementById('scrollhere')\r\n    if (element) {\r\n      element.scrollIntoView({ behavior: 'smooth' })\r\n    }\r\n  }\r\n  \r\n})\r\n</script>\r\n\r\n\r\n\r\n<template>\r\n\r\n\r\n<div  class=\"bg-gray-100 font-family-karla flex\">\r\n\t<Sidebar />\r\n\r\n    <div class=\"relative w-full flex flex-col h-screen overflow-y-hidden\">\r\n        <!-- Desktop Header -->\r\n        <header class=\"w-full items-center bg-white py-2 px-6 hidden sm:flex\">\r\n            <div class=\"w-1/2\"></div>\r\n            <div  class=\"relative w-1/2 flex justify-end\">\r\n\t\t\t View Categories \r\n            </div>\r\n        </header>\r\n\r\n        <!-- Mobile Header & Nav -->\r\n       <MobileHeader />\r\n    \r\n        <div class=\"w-full h-screen overflow-x-hidden border-t flex flex-col\">\r\n            <main class=\"w-full flex-grow p-6\">\r\n\t\t\t<h1 class=\"text-2xl font-bold mb-4\">View Categories\r\n\t\t\t\r\n\t\t\t  <NuxtLink to=\"/admin/cat/addcategory\" class=\" widthmax300 bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded\">\r\n\t\t\t\t\t\t  <i class=\"fas fa-align-left mr-3\"></i>Add Category</NuxtLink>\r\n\t\t\t </h1>\r\n\t\t\t\r\n\t\t\t<div class= 'bold red font18' v-if=\"message\">{{ message }}</div>\r\n\t\t\t\r\n\t\t\t<CatsAdmin \r\n\t\t\t  :cats=\"cats\" \r\n\t\t\t  :currentPage=\"currentPage\" \r\n\t\t\t  :lastPage=\"lastPage\" \r\n\t\t\t  :changePage=\"changePage\" \r\n\t\t\t  :pageNumbers=\"pageNumbers\"  \r\n\t\t\t  :key=\"key.value\" \r\n\t\t\t/>\r\n\t\t\t<div class= 'bold red font18' v-if=\"message\" id = 'scrollhere'> {{ message }}</div>\r\n\t\t\t<p>Current Route: {{ $route.path }}</p>\r\n\t\t\t<button @click.native=\"refreshRoute\"\r\n\t\t\tclass=\"bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded mt-3\">Refresh Route</button>\t\t\r\n\r\n\r\n\t\t\t\r\n            </main>\r\n    \r\n            <footer class=\"w-full bg-white text-right p-4\">\r\n                \r\n            </footer>\r\n        </div>\r\n\t\t\r\n\t</div>\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t</div>\r\n\r\n\r\n\r\n</template>\r\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAkDe,cAAW;AACZ,aAAU;AAExB,UAAM,YAAY,aAAc;AAOf,eAAY;AACd,qBAAkB,EAAC,OAAO;AAEzC,UAAM,UAAU,SAAS,MAAM,UAAU,QAAQ,UAAU,KAAK,WAAW,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACvD5E,UAAM,SAAS,iBAAkB;AAIjC,UAAM,QAAQ;AAyBd,UAAM,MAAM,MAAM,MAAM,CAAC,YAAY;AACnC,cAAQ,IAAI,sBAAsB,OAAO;AAAA,IAC3C,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;ACpCM,SAAS,mBAAmB;AACjC,QAAM,EAAE,KAAM,IAAG,WAAY;AAC7B,QAAM,SAAS,mBAAmB,OAAO;AAEzC,QAAM,OAAO,IAAI,EAAE;AACnB,QAAM,cAAc,IAAI,CAAC;AACzB,QAAM,WAAW,IAAI,CAAC;AACtB,QAAM,UAAU,IAAI,EAAE;AACtB,QAAM,YAAY,IAAI,CAAC;AAEvB,QAAM,YAAY,OAAO,OAAO,MAAM;AACpC,QAAI;AACF,YAAM,WAAW,MAAM,KAAK,IAAI,GAAG,MAAM,wBAAwB,IAAI,aAAa,QAAQ,KAAK,EAAE;AACjG,WAAK,QAAQ,SAAS,KAAK;AAE3B,kBAAY,QAAQ,SAAS,KAAK;AAClC,eAAS,QAAQ,SAAS,KAAK;AAC/B,gBAAU,QAAQ,SAAS,KAAK;AAAA,IACjC,SAAQ,OAAO;AACd,cAAQ,MAAM,yBAAyB,MAAM,WAAW,MAAM,SAAS,OAAO,MAAM,OAAO;AAAA,IAC5F;AAAA,EACF;AAED,QAAM,aAAa,CAAC,SAAS;AAC3B,QAAI,OAAO,KAAK,QAAQ,SAAS,OAAO;AACtC,kBAAY,QAAQ;AACpB,gBAAU,IAAI;AAAA,IACf;AAAA,EACF;AAGD,QAAM,cAAc,SAAS,MAAM;AACjC,QAAI,QAAQ,CAAE;AACd,aAAS,IAAI,GAAG,KAAK,SAAS,OAAO,KAAK;AACxC,YAAM,KAAK,CAAC;AAAA,IACb;AACD,WAAO;AAAA,EACX,CAAG;AAED,SAAO;AAAA,IACL;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA;AAAA,EACD;AACH;;;;;AC3CM,UAAA,EAAE,MAAM,aAAa,UAAU,YAAY,aAAa,cAAc;AAWtE,UAAA,MAAM,IAAI,CAAC;AAEF,cAAU;AACzB,UAAM,QAAQ;AAEd,UAAM,UAAU,IAAI,MAAM,MAAM,WAAW,EAAE;AAG3B,iBAAa;AAwCzB,UAAA,OAAO,OAAO,UAAU,aAAa;AACzC,cAAQ,IAAI,sBAAsB,SAAS,MAAM,MAAM,SAAS,IAAI;AACpE,YAAM,UAAU;AAAA,IAAA,CACjB;AAED,UAAM,MAAM,MAAM,MAAM,SAAS,CAAC,eAAe;AAC/C,cAAQ,QAAQ;AAIhB,UAAI,QAAQ,OAAO;AACX,cAAA,UAAmB,SAAA,eAAe,YAAY;AACpD,YAAI,SAAS;AACX,kBAAQ,eAAe,EAAE,UAAU,SAAU,CAAA;AAAA,QAC/C;AAAA,MACF;AAAA,IAAA,CAED;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;"}